class t{static init(t){this.apiKey=t}static initBackend(t){t&&(this.BASE_URL=t.baseUrl)}static setSessionId(t){this.sessionId=t}static registerSession(){const t=this.BASE_URL+"/verify";return new Promise((e,i)=>{fetch(t,{method:"GET",headers:{"api-key":this.apiKey}}).then(t=>t.json()).then(t=>{e(t)}).catch(t=>i(t))})}static registerEvent(t){const e=this.BASE_URL+"/events?"+`session_id=${this.sessionId}`,i={method:"POST",headers:{"api-key":this.apiKey,"Content-Type":"application/json"},body:JSON.stringify({data:t})};return new Promise((t,s)=>{fetch(e,i).then(t=>t.json()).then(e=>{t(e)}).catch(t=>s(t))})}}t.apiKey=void 0,t.sessionId=void 0,t.BASE_URL=void 0;class e{constructor(t){var e,i,s;this.isTrusted=void 0,this.altKey=void 0,this.button=void 0,this.buttons=void 0,this.clientX=void 0,this.clientY=void 0,this.ctrlKey=void 0,this.detail=void 0,this.element=void 0,this.layerX=void 0,this.layerY=void 0,this.metaKey=void 0,this.movementX=void 0,this.movementY=void 0,this.offsetX=void 0,this.offsetY=void 0,this.pageX=void 0,this.pageY=void 0,this.pointerType=void 0,this.screenX=void 0,this.screenY=void 0,this.shiftKey=void 0,this.x=void 0,this.y=void 0,this.timestamp=void 0,this.isTrusted=t.isTrusted,this.altKey=t.altKey,this.button=t.button,this.buttons=t.buttons,this.clientX=t.clientX,this.clientY=t.clientY,this.ctrlKey=t.ctrlKey,this.detail=t.detail,this.element={tagName:null==(e=t.target)?void 0:e.tagName,id:null==(i=t.target)?void 0:i.id,disabled:null==(s=t.target)?void 0:s.disabled},this.layerX=t.layerX,this.layerY=t.layerY,this.metaKey=t.metaKey,this.movementX=t.movementX,this.movementY=t.movementY,this.offsetX=t.offsetX,this.offsetY=t.offsetY,this.pageX=t.pageX,this.pageY=t.pageY,this.pointerType=t.pointerType,this.screenX=t.screenX,this.screenY=t.screenY,this.shiftKey=t.shiftKey,this.x=t.x,this.y=t.y,this.timestamp=Date.now()}getData(){return{isTrusted:this.isTrusted,altKey:this.altKey,button:this.button,buttons:this.buttons,clientX:this.clientX,clientY:this.clientY,ctrlKey:this.ctrlKey,detail:this.detail,element:this.element,layerX:this.layerX,layerY:this.layerY,metaKey:this.metaKey,movementX:this.movementX,movementY:this.movementY,offsetX:this.offsetX,offsetY:this.offsetY,pageX:this.pageX,pageY:this.pageY,pointerType:this.pointerType,screenX:this.screenX,screenY:this.screenY,shiftKey:this.shiftKey,timestamp:this.timestamp,x:this.x,y:this.y}}}class i{constructor(){this.documentBody=void 0,this.currentTime=void 0,this.BOUNCE=500,this.SEND_FREQUENCY=2e4,this.sequenceData=void 0,this.intervalObj=void 0,this.initialize=()=>{this.currentTime=Date.now(),this.intervalObj=setInterval(()=>{this.sendData()},this.SEND_FREQUENCY),this.attachMouseEvent()},this.sendData=()=>{let e=!0;if(Array.isArray(this.sequenceData))for(const t of this.sequenceData)if(Array.isArray(t)&&t.length>0){e=!1;break}e||t.registerEvent(this.sequenceData),this.initSequenceData()},this.mouseClickEvent=t=>{const i=Date.now(),s=new e(t);i-this.currentTime<this.BOUNCE?this.sequenceData[this.sequenceData.length-1].push(s.getData()):this.sequenceData.push([s.getData()]),this.currentTime=i},this.stopEvents=()=>{this.intervalObj&&(clearInterval(this.intervalObj),this.intervalObj=null)},this.documentBody=document.body,this.sequenceData=[[]],this.currentTime=0,this.intervalObj=null}initSequenceData(){this.sequenceData=[[]]}attachMouseEvent(){this.documentBody&&this.documentBody.addEventListener("pointerup",this.mouseClickEvent)}}class s{constructor(e,s){this.apiKey=void 0,this.captureObj=void 0,this.apiKey=e,this.captureObj=new i,s&&s.backend&&(t.init(e),t.initBackend(s.backend))}initialize(){t.registerSession().then(e=>{e&&(this.captureObj.initialize(),e.session_id&&t.setSessionId(e.session_id))})}}export{s as TraceEvent};
